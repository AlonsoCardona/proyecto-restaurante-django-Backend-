{% extends "main/dashboard_base.html" %}

{% block title %}Detalles Orden - Izakaya Sakura{% endblock %}
{% block page_title %}Orden No. {{ orden.id }} - {{ orden.fecha|date:"d/m/Y H:i" }}{% endblock %}
{% block page_subtitle %}Agrega o edita los platillos de esta orden{% endblock %}

{% block extra_style %}
<style>
    .form-container { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 2rem; }
    .form-group { margin-bottom: 1.5rem; }
    .form-group label { font-weight: 600; color: #333; margin-bottom: 0.5rem; display: block; }
    .form-control { width: 100%; padding: 0.875rem; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1rem; transition: all 0.3s; }
    .form-control:focus { outline: none; border-color: #c41e3a; box-shadow: 0 0 0 0.2rem rgba(196, 30, 58, 0.15); }
    textarea.form-control { min-height: 80px; resize: vertical; }
    .btn-submit { background: linear-gradient(135deg, #c41e3a 0%, #8b0000 100%); color: white; padding: 0.875rem 2rem; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(196, 30, 58, 0.4); }
    
    .detalles-table { background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); overflow: hidden; }
    .table { margin: 0; }
    .table thead { background: linear-gradient(135deg, #c41e3a 0%, #8b0000 100%); color: white; }
    .table thead th { padding: 1rem; font-weight: 600; border: none; }
    .table tbody td { padding: 1rem; vertical-align: middle; border-bottom: 1px solid #f0f0f0; }
    .table tbody tr:last-child td { border-bottom: none; }
    .table tbody tr:hover { background: #f8f9fa; }
    
    .btn-action-small { padding: 0.5rem 1rem; border-radius: 8px; border: none; font-weight: 600; font-size: 0.875rem; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 0.3rem; transition: all 0.3s; margin-right: 0.5rem; }
    .btn-edit-small { background: #007bff; color: white; }
    .btn-edit-small:hover { background: #0056b3; color: white; transform: translateY(-1px); }
    .btn-delete-small { background: #dc3545; color: white; }
    .btn-delete-small:hover { background: #c82333; color: white; transform: translateY(-1px); }
    
    .btn-back { background: #6c757d; color: white; padding: 0.875rem 2rem; border: none; border-radius: 10px; font-weight: 600; text-decoration: none; display: inline-block; transition: all 0.3s; margin-top: 1rem; }
    .btn-back:hover { background: #545b62; color: white; transform: translateY(-2px); }
    
    .empty-state { text-align: center; padding: 3rem; color: #999; }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <h3 style="margin-bottom: 1.5rem; color: #333;"><i class="bi bi-plus-circle"></i> Agregar Platillo</h3>
    <form method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="{{ form.platillo.id_for_label }}">Platillo</label>
            {{ form.platillo }}
        </div>
        <div class="form-group">
            <label for="{{ form.cantidad.id_for_label }}">Cantidad</label>
            {{ form.cantidad }}
        </div>
        <div class="form-group">
            <label for="{{ form.notas.id_for_label }}">Notas (opcional)</label>
            {{ form.notas }}
        </div>
        {{ form.orden_id }}
        <button type="submit" class="btn-submit"><i class="bi bi-check-circle"></i> Agregar a la Orden</button>
    </form>
</div>

<div class="detalles-table">
    <table class="table">
        <thead>
            <tr>
                <th>Acciones</th>
                <th>Platillo</th>
                <th>Cantidad</th>
                <th>Notas</th>
                <th>Precio Unit.</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% if orden_detalles %}
                {% for detalle in orden_detalles %}
                <tr>
                    <td>
                        <a href="{% url 'ordenes:orden_detalle_update' detalle.id %}" class="btn-action-small btn-edit-small">
                            <i class="bi bi-pencil"></i> Editar
                        </a>
                        <a href="{% url 'ordenes:orden_detalle_delete' detalle.id %}" class="btn-action-small btn-delete-small">
                            <i class="bi bi-trash"></i>
                        </a>
                    </td>
                    <td><strong>{{ detalle.platillo.nombre }}</strong></td>
                    <td>{{ detalle.cantidad }}</td>
                    <td>{{ detalle.notas|default:"-" }}</td>
                    <td>${{ detalle.precio_unitario|floatformat:2 }}</td>
                    <td><strong>${{ detalle.subtotal|floatformat:2 }}</strong></td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" class="empty-state">
                        <i class="bi bi-inbox" style="font-size: 3rem; color: #ddd; display: block; margin-bottom: 0.5rem;"></i>
                        No hay platillos en esta orden. Agrega el primero arriba.
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<div style="margin-top: 2rem;">
    <a href="{% url 'ordenes:orden_list' %}" class="btn-back"><i class="bi bi-arrow-left"></i> Regresar a Ã“rdenes</a>
</div>
{% endblock %}
